services:
  checker:
    build: .
    container_name: prosellers-checker
    ports:
      - "8888:8888"
    depends_on:
      - proxy-service
      - logs
      - redis
    environment:
      - PORT=8888
      - API_KEY=b009302d-deda-4e0d-a93a-cc1d342ea563
      - PROXY_API_URL=http://proxy-service/api.php
      - PROXY_API_KEY=83853b46-5d66-45f2-9de6-f4c563003147
      - LOG_SERVER_URL=http://logs/api.php
      - USE_PROXY_DEFAULT=true
      - REDIS_URL=redis://redis:6379
    volumes:
      - .:/app
      - ./docker_data:/app/data
      - ./log:/app/log
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 256M

  worker:
    build: .
    container_name: prosellers-worker
    command: python3 worker.py
    depends_on:
      - redis
      - proxy-service
    environment:
      - REDIS_URL=redis://redis:6379
      - PROXY_API_URL=http://proxy-service/api.php
      - PROXY_API_KEY=83853b46-5d66-45f2-9de6-f4c563003147
      - LOG_SERVER_URL=http://logs/api.php
      - USE_PROXY_DEFAULT=true
    volumes:
      - .:/app
      - ./docker_data:/app/data
      - ./log:/app/log
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 256M

  redis:
    image: redis:alpine
    container_name: prosellers-redis
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 128M

  proxy-service:
    build: ./proxy-service
    container_name: prosellers-proxy-service
    ports:
      - "8801:80"
      - "9900-9950:9900-9950"
    volumes:
      - ./proxy-service:/var/www/html
    cap_add:
      - NET_ADMIN
    environment:
      - PROXY_ADMIN_PASSWORD=prosellers@2025
      - PROXY_API_KEY=83853b46-5d66-45f2-9de6-f4c563003147
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 256M

  logs:
    build: ./log
    container_name: prosellers-logs
    ports:
      - "8803:80"
    volumes:
      - ./log:/var/www/html
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 256M

  seoinfo:
    build: ./seoinfo
    container_name: prosellers-seoinfo
    ports:
      - "8804:80"
    volumes:
      - ./seoinfo:/var/www/html
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 256M

networks:
  default:
    name: prosellers-network
